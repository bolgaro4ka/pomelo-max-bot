from entities.scan_entity import ScanEntity


HELLO_MSG = """**–ü—Ä–∏–≤–µ—Ç üëã –Ø ‚Äî –±–æ—Ç Pomelo üçã**

–ü–æ–º–æ–≥–∞—é —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Å–æ—Å—Ç–∞–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: 
- –ù–∞—Ö–æ–∂—É –æ–ø–∞—Å–Ω—ã–µ –ï-–¥–æ–±–∞–≤–∫–∏
-Ô∏è –û—Ü–µ–Ω–∏–≤–∞—é –≤—Ä–µ–¥–Ω–æ—Å—Ç—å
- –î–∞—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∏—Ç–∞–Ω–∏—é 
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é –æ –Ω–∞–ª–∏—á–∏–∏ –∞–ª–ª–µ—Ä–≥–µ–Ω–æ–≤

_–í–≤–µ–¥–∏—Ç–µ /help, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥_

üì∏ –û—Ç–ø—Ä–∞–≤—å —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ñ–æ—Ç–æ —Å–æ—Å—Ç–∞–≤–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑"""

ABOUT_MSG = """**ü•≠ –û Pomelo**
–≠—Ç–æ —á–∞—Ç-–±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Å—Ç–∞–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

**üì∏ –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ —Å–æ—Å—Ç–∞–≤ ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤!**

Pomelo –≤—ã—è–≤–ª—è–µ—Ç –æ–ø–∞—Å–Ω—ã–µ –ï-–¥–æ–±–∞–≤–∫–∏, —Å–∞—Ö–∞—Ä, –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç—ã, –∫—Ä–∞—Å–∏—Ç–µ–ª–∏ –∏ –∞–ª–ª–µ—Ä–≥–µ–Ω—ã –∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–¥—É–∫—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –≤–∞—à–µ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è

**üéì –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç–æ—á–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö –∏ –±–æ–ª—å—à–æ–π –Ω–∞—É—á–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–æ–∫**

–° –ø–æ–º–æ—â—å—é OCR (–æ–ø—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤) –º—ã –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–∞–≤–∞ –∏ —Å –ø–æ–º–æ—â—å—é –±–æ–ª—å—à–æ–π –Ω–∞—É—á–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–æ–∫, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±—Ä–∞–Ω–∞ –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–π—Ç –¥–æ–±–∞–≤–∫–∞–º.–Ω–µ—Ç), —Å—á–∏—Ç–∞–µ–º –∏–Ω–¥–µ–∫—Å –≤—Ä–µ–¥–Ω–æ—Å—Ç–∏ - —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 100, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω—É—é –≤—Ä–µ–¥–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞. –ë–ª–∞–≥–æ–¥–∞—Ä—è —á—ë—Ç–∫–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±—É–¥–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º

–¢–∞–∫–∂–µ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–π—Ä–æ—Å–µ—Ç—å-–Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–∞—ë—Ç –ø–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

**üçè –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ —Å–æ—Å—Ç–∞–≤ ‚Äî –≤—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è**

70% –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–æ–±–∞–≤–∫–∏, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ. –ù–∞—à —Å–∫–∞–Ω–µ—Ä –ø–æ–º–æ–≥–∞–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å ‚Äî –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ —Å–∫—Ä—ã—Ç—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
"""

DISCLAIMER_MSG = """**‚ö† –î–∏—Å–∫–ª–µ–π–º–µ—Ä**

–ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ —Å–∞–π—Ç–∞ –î–æ–±–∞–≤–∫–∞–º.–Ω–µ—Ç –∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π.

–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ—Å—Ç–∞–≤ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.
"""

HELP_MSG = """**üïπ –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥**

`/start` - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
`/help` - —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
`/scanner` - —Å–∫–∞–Ω–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤
`/about` - –æ Pomelo
`/disclaimer` - –¥–∏—Å–∫–ª–µ–π–º–µ—Ä
"""

SCANNER_MSG = """**üì∏ –û—Ç–ø—Ä–∞–≤—å —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ñ–æ—Ç–æ —Å–æ—Å—Ç–∞–≤–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑**"""

def get_progress_bar_msg(status: str) -> str:
    """
    Generate progress bar based on scan status
    """

    # Define progress stages
    stages = {
        'recognition_pending': (0, '‚è≥ –í –æ—á–µ—Ä–µ–¥–∏'),
        'recognizing': (1, 'üîç –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–∞'),
        'recognized': (2, 'üëÅ –°–æ—Å—Ç–∞–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω'),
        'analysis_pending': (3, '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞'),
        'ai_analysis_pending': (3, '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞'),
        'analyzing': (4, 'üß™ –ê–Ω–∞–ª–∏–∑ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤'),
        'ai_analyzing': (4, 'üß† –ò–ò-–Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥ –¥—É–º–∞–µ—Ç'),
        'analyzed': (5, '‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω'),
        'ai_analyzed': (5, '‚úÖ –ò–ò-–∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω'),
        'completed': (6, 'üéâ –ì–æ—Ç–æ–≤–æ!')
    }

    if status not in stages:
        return f"–ó–∞–≥—Ä—É–∑–∫–∞... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ"

    current_step, status_text = stages[status]
    total_steps = 7

    # Build progress bar
    filled = 'üü©' * current_step
    empty = '‚¨úÔ∏è' * (total_steps - current_step)
    percentage = int((current_step / total_steps) * 100)

    progress_bar = f"{filled}{empty} {percentage}%\n{status_text}"

    return progress_bar

def get_scan_msg(scan_entity: ScanEntity) -> list[str]:
    """
    Generate a list of messages representing the scan result.
    """

    data = scan_entity._data or {}

    # Name
    name = data.get("name") or "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"
    if name.strip("* "):
        name = name.strip()
    else:
        name = "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"

    # Allergens
    allergens = data.get("analysis", {}).get("allergens", [])
    if allergens:
        allergen_lines = [f"* {a.capitalize()}" for a in allergens]
        allergens_block = "\n".join(allergen_lines)
        allergens_title = "**–ê–ª–ª–µ—Ä–≥–µ–Ω—ã**"
    else:
        allergens_title = "**–ê–ª–ª–µ—Ä–≥–µ–Ω—ã –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã**"
        allergens_block = "–ù–æ –º—ã –º–æ–≥–ª–∏ –æ—à–∏–±–∏—Ç—å—Å—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ—Å—Ç–∞–≤ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ"

    # AI analysis
    ai_analysis = scan_entity.ai_analysis or "–ê–Ω–∞–ª–∏–∑ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω"

    # Check for links
    has_additives_links = any(
        ingr.get("referenceUrl")
        for ingr in scan_entity.ingredients
    )

    additives_title = "**–î–æ–±–∞–≤–∫–∏**" if has_additives_links else ""

    # Components
    composition = data.get("composition") or "–°–æ—Å—Ç–∞–≤ –Ω–µ —É–∫–∞–∑–∞–Ω"

    # Generate messages
    msg_left = (
        f"**{name}**\n\n"
        f"{allergens_title}\n{allergens_block}\n\n"
        f"**AI –∞–Ω–∞–ª–∏–∑**\n{ai_analysis}\n\n"
        f"{additives_title}"
    )

    msg_right = f"**–°–æ—Å—Ç–∞–≤:**\n{composition}"

    return [msg_left, msg_right]
